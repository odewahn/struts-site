<?xml version="1.0"?>
<document url="guess-example.html">

  <properties>
    <title>Struts Flow - Number Guess Example</title>
  </properties>

  <body>
      <section name="Number Guessing Game Example">
      <a name="overview"/>
        <p>This example shows a number guessing game implemented with Struts Flow.  The goal is to show the basic concepts of continuations, so the example is kept simple.
        There are basically three parts to the example: the flow code, the Struts config, and the JSP's that display the output.  
        </p>
      </section>
      
      <section name="Flow Code">
      <a name="flow"/>
        <p>Here is what the flow code looks like:
        </p>
<pre>
function main() {

  var random =  Math.round( Math.random() * 9 ) + 1;
  var hint = "No hint for you!"
  var guesses = 0;

  while (true) {

    // send guess page to user and wait for response
    forwardAndWait("failure", 
       { "random"  : random, 
         "hint"    : hint,
         "guesses" : guesses} );

    // process user's guess
    var guess = parseInt( struts.param.guess );
    guesses++;
    if (guess) {
      if (guess > random) {
        hint = "Nope, lower!"
      } 
      else if (guess &lt; random) {
        hint = "Nope, higher!"
      } 
      else {
        // correct guess
        break;
      }
    }
  }

  // send success page to user
  forwardAndWait("success", 
     {"random"  : random, 
      "guess"   : guess, 
      "guesses" : guesses} );
}
</pre>
        <p>Notice how the program loops until the number is guessed, even though pages are being sent to the 
        browser to gather user input.</p>
    </section>
    <section name="Struts Configuration">
    <a name="struts"/>
        <p>To configure this application with Struts, the following action mapping and plug-in are defined in <code>struts-config.xml</code>:</p>
<pre>
&lt;action-mappings>

    &lt;action    path="/guess"
               type="net.sf.struts.flow.FlowAction"
          className="net.sf.struts.flow.FlowMapping">
           
      &lt;set-property property="function"   value="main"/>     
      &lt;forward name="failure"              path="/guess.jsp"/>
      &lt;forward name="success"              path="/success.jsp"/>
    &lt;/action>
&lt;/action-mappings>   


&lt;plug-in className="net.sf.struts.flow.FlowPlugIn">
    &lt;set-property property="scripts" value="/WEB-INF/numberguess.js" />
&lt;/plug-in>
</pre>
    <p> The <code>function</code> property of the custom action mapping tells <code>FlowAction</code> which
    JavaScript function to call.</p>
  </section>
  <section name="JSP Presentation">
  <a name="jsp"/>
        <p>To gather the user's guess, <code>guess.jsp</code> generates a form:</p>
<pre>
&lt;html>
&lt;head>
  &lt;title>Struts Flow number guessing game&lt;/title>
&lt;/head>
&lt;body>

  &lt;h1>Guess the Number Between 1 and 10&lt;/h1>
  
  &lt;h2>&lt;%= request.getAttribute("hint") %>&lt;/h2>
  
  &lt;h3>You've guessed &lt;%= request.getAttribute("guesses") %> times.&lt;/h3>
  
  &lt;form method="post" action="guess.do">
    &lt;input type="hidden" name="contid" value='&lt;%= request.getAttribute("contid") %>' />
    &lt;input type="text" name="guess"/>
    &lt;input type="submit"/>
  &lt;/form>
  
&lt;/body>
&lt;/html>
</pre>
<p>The hidden input variable <code>contid</code> stores the continuation to load from when the form gets submitted.</p>
        
      </section>
  </body>
</document>
